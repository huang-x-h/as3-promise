<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" 
				creationComplete="application1_creationCompleteHandler(event)">
	<mx:Script>
		<![CDATA[
			import com.dormouse.Promise;
			
			import mx.events.FlexEvent;
			
			protected function application1_creationCompleteHandler(event:FlexEvent):void
			{
				get('test').then(function(result:Object):Promise {
					trace(result);
					return get(result + "123");
				}).then(function(result:Object):void {
					trace(result);
					throw new Error('Message Error2');
				}).error(function(reason:*):void {
					trace(reason);
				}).then(function(result:*):void {
					all();
				});
			}
			
			private function all():void {
				var promise1:Promise = get('test1');
				var promise2:Promise = get('test2');
				var promise3:Promise = get('test3');
				var promise4:Promise = Promise.resolve('test4');
				
				Promise.all([promise1, promise2, promise3, promise4]).then(function(result:Array):void {
					trace(result);
				});
			}
			
			private function get(url:String):Promise {
				return new Promise(function(resolve:Function, reject:Function):void {
					setTimeout(function():void {
						resolve(url);
					}, 2000);
				});
			}
			
		]]>
	</mx:Script>
	
</mx:Application>
